import mongoose from 'mongoose';  
// ูุงุฑุฏ ฺฉุฑุฏู ฺฉุชุงุจุฎุงููโ mongoose ุจุฑุง ุงุฑุชุจุงุท ุจุง ุฏุชุงุจุณ MongoDB

const DB_URI = process.env.DB_URI;  
// ฺฏุฑูุชู ููุฏุงุฑ ุขุฏุฑุณ ุฏุชุงุจุณ ุงุฒ ูุชุบุฑ ูุญุท ุชุนุฑูโุดุฏู ุฏุฑ ูุงู .env.local

if (!DB_URI) {
  throw new Error('โ ูุทูุงู ูุชุบุฑ ูุญุท DB_URI ุฑุง ุฏุฑ ูุงู .env.local ุชุนุฑู ฺฉูุฏ');
}
// ุงฺฏุฑ ุขุฏุฑุณ ุฏุชุงุจุณ ุชุนุฑู ูุดุฏู ุจุงุดุฏุ ุงุฌุฑุง ุจุฑูุงูู ูุชููู ุดุฏู ู ุฎุทุง ููุงุด ุฏุงุฏู ูโุดูุฏ

// ุชุงุจุน ุจุฑุง ุงุชุตุงู ุจู ุฏุชุงุจุณ MongoDB ุชุนุฑู ูโฺฉูู
async function dbConnect() {
  if (mongoose.connection.readyState >= 1) {
    console.log('โ MongoDB already connected');
    return;
  }
  // ุงฺฏุฑ ุงุชุตุงู ูุจูุงู ุจุฑูุฑุงุฑ ุดุฏู ุจุงุดุฏุ ูุฌุฏุฏ ุชูุงุด ุจู ุงุชุตุงู ุงูุฌุงู ููโุดูุฏ

  try {
    console.log('๐ Connecting to MongoDB...');
    // ุชูุงุด ุจุฑุง ุจุฑูุฑุงุฑ ุงุชุตุงู ุฌุฏุฏ ุจู ุฏุชุงุจุณ

    const options = {
      useNewUrlParser: true,             // ุงุณุชูุงุฏู ุงุฒ ูพุงุฑุณุฑ ุฌุฏุฏ ุจุฑุง ุขุฏุฑุณ ุฏุชุงุจุณ
      useUnifiedTopology: true,          // ุงุณุชูุงุฏู ุงุฒ ุณุณุชู ุฌุฏุฏ ูุฏุฑุช ุงุชุตุงู
      serverSelectionTimeoutMS: 10000,   // ุญุฏุงฺฉุซุฑ ุฒูุงู ุงูุชุธุงุฑ ุจุฑุง ุงูุชุฎุงุจ ุณุฑูุฑ (ุจุฑ ุญุณุจ ููโุซุงูู)
    };

    await mongoose.connect(DB_URI, options);
    // ุจุฑูุฑุงุฑ ุงุชุตุงู ุจู MongoDB ุจุง ุงุณุชูุงุฏู ุงุฒ ุขุฏุฑุณ ู ุชูุธูุงุช ุฏุงุฏูโุดุฏู

    console.log('โ Connected to MongoDB successfully');
    // ุฏุฑ ุตูุฑุช ููููุชโุขูุฒ ุจูุฏู ุงุชุตุงูุ ูพุงู ููููุช ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ูโุดูุฏ

  } catch (error) {
    console.error('โ MongoDB connection error:', error);
    // ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุฎุทุง ููฺฏุงู ุงุชุตุงูุ ูพุงู ุฎุทุง ุฏุฑ ฺฉูุณูู ููุงุด ุฏุงุฏู ูโุดูุฏ

    throw error;
    // ุงุฑุณุงู ุฎุทุง ุจู ุจุฎุด ูุฑุงุฎูุงู ฺฉููุฏูโ ุชุงุจุน ุจุฑุง ูุฏุฑุช ุจูุชุฑ ุฎุทุง
  }
}

export default dbConnect;
// ุตุงุฏุฑ ฺฉุฑุฏู ุชุงุจุน dbConnect ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุณุงุฑ ูุงูโูุง
